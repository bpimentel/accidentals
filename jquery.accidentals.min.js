/*
	jQuery Accidentals
	Copyright 2012 by Bret Pimentel http://bretpimentel.com
	Available under MIT license. See LICENSE.txt for more information.
*/

(function(c){c.fn.accidentals=function(b){function i(b,c){for(var a in b)b.hasOwnProperty(a)&&c(a,b[a])}function j(a,d,e){var f;if(!b.ignoreWithin||b.ignoreWithin&&0===c(a).closest(b.ignoreWithin).length)3===a.nodeType?(f=a.nodeValue.replace(d,e),/</.test(f)?c(a).before(f).remove():a.nodeValue=f):1===a.nodeType&&c(a).contents().each(function(){j(this,d,e)})}var a,d={doubleFlat:{text:"-double-flat","b#":"bb",replacement:"\ud834\udd2b",safe:!0},doubleSharp:{text:"-double-sharp","b#":"##",replacement:"\ud834\udd2a",
safe:!0},natural:{text:"-natural","b#":"nat",replacement:"\u266e",safe:!0},flat:{text:"-flat","b#":"b",replacement:"\u266d",safe:!0},sharp:{text:"-sharp","b#":"#",replacement:"\u266f",safe:!0}},k=["iPod","iPhone","iPad"],b=c.extend(!0,{accidentalClassBase:"accidental",accidentalWrap:'<span class="accidental" />',caseSensitive:!1,ignoreWithin:".no-accidentals",inputTypes:["text"],noteNames:"[A-H]",noteNameWrap:"",outerWrap:"",safeMode:!0},b);b.caseSensitive=b.caseSensitive?"":"i";b.safeMode&&(a=c('<div style="visibility: hidden" />').appendTo(c(this).first()),
i(d,function(b,c){a.append('<span style="font-size: 999px; margin: 0; padding: 0;" class="'+b+'">'+c.replacement+"</span>")}),!navigator.userAgent.match(RegExp(k.join("|"),"gi"))&&(a.find(".flat").width()===a.find(".sharp").width()&&a.find(".flat").width()===a.find(".natural").width())&&(d.flat.safe=!1,d.sharp.safe=!1,d.natural.safe=!1),a.find(".doubleFlat").width()===a.find(".doubleSharp").width()&&(d.doubleFlat.safe=!1,d.doubleSharp.safe=!1),a.remove());return this.each(function(){var a=c(this);
i(b.inputTypes,function(k,e){i(d,function(f,g){d[f].safe&&a.contents().each(function(){var a;j(this,RegExp("\\b("+b.noteNames+")("+g[e]+")(?=(s)?(\\b|\\s|\\W|$))","g"+b.caseSensitive),function(d,f){var e=f,h=g.replacement;b.noteNameWrap&&(e=c(b.noteNameWrap).text(e).wrap("<div />").parent().html());b.accidentalWrap&&(a=b.accidentalClassBase?g.text:g.text.replace(/^-/,""),h=c(b.accidentalWrap).addClass(b.accidentalClassBase+a).text(h).wrap("<div />").parent().html());return b.outerWrap?c(b.outerWrap).html(e+
h).wrap("<div />").parent().html():e+h})})})})})}})(jQuery);